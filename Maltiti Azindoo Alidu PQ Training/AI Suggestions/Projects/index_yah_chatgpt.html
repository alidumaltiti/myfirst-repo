<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Youth Digital Advocacy Hub ‚Äî Prototype</title>
  <meta name="description" content="A mobile-first prototype for youth to share issues, propose solutions, and collaborate with mentors across Ghana. Includes gamification (badges, XP, leaderboard), media hub, accessibility and localization toggles."/>
  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --panel:#111827;        /* gray-900 */
      --panel-2:#0b1222;      /* deep */
      --text:#e5e7eb;         /* gray-200 */
      --muted:#94a3b8;        /* slate-400 */
      --brand:#22c55e;        /* green-500 */
      --brand-2:#3b82f6;      /* blue-500 */
      --warn:#f59e0b;         /* amber-500 */
      --danger:#ef4444;       /* red-500 */
      --card:#0b1222;
      --border:#1f2937;
      --elev:0 6px 20px rgba(0,0,0,.25);
    }
    .high-contrast:root, .high-contrast body{
      --bg:#000; --panel:#000; --panel-2:#000; --text:#fff; --muted:#fff; --card:#000; --border:#fff; --brand:#0ff; --brand-2:#ff0; --warn:#ff0; --danger:#f00;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#060b1a 60%); color:var(--text);
      font: 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    }
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:80px 16px 100px}
    header.appbar{
      position:sticky; top:0; z-index:50; backdrop-filter:saturate(160%) blur(10px);
      background:rgba(11,18,34,.75); border-bottom:1px solid var(--border);
    }
    .appbar-inner{display:flex;align-items:center;gap:12px;padding:12px 16px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .logo .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--brand),var(--brand-2)); box-shadow:0 0 12px var(--brand)}
    .badge{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#0b1222,#111827); border:1px solid var(--border); color:var(--muted); padding:6px 10px; border-radius:999px; font-size:12px}
    .badge .pulse{width:8px;height:8px;border-radius:50%;background:var(--brand); box-shadow:0 0 0 6px rgba(34,197,94,.15)}

    /* Layout */
    .grid{display:grid;gap:16px}
    .hero{display:grid; gap:16px; grid-template-columns:1.2fr .8fr; align-items:stretch}
    @media (max-width:900px){ .hero{grid-template-columns:1fr} }

    .card{background:linear-gradient(180deg,var(--card),#0e162c); border:1px solid var(--border); border-radius:18px; box-shadow:var(--elev)}
    .card-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border)}
    .card-body{padding:16px}
    .card h3{margin:0;font-size:18px}

    /* Buttons */
    .btn{appearance:none;border:none;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:600;background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#06111b}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
    .btn.icon{display:inline-flex;align-items:center;gap:8px}
    .btn.sm{padding:8px 10px;font-size:14px;border-radius:10px}

    input,select,textarea{width:100%;background:#0b1222;border:1px solid var(--border); color:var(--text); border-radius:12px; padding:10px}
    textarea{min-height:110px;resize:vertical}
    label{font-size:13px;color:var(--muted)}

    /* Tabs */
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid var(--border);color:var(--muted);cursor:pointer}
    .tab.active{border-color:transparent;background:linear-gradient(135deg,#1b2a4a,#112040); color:#cfe1ff}

    /* Feed */
    .issue{display:grid;gap:8px;border:1px solid var(--border); background:linear-gradient(180deg,#0c1429,#0b1222); padding:14px;border-radius:16px}
    .issue .meta{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:13px}
    .chip{padding:4px 8px;border-radius:999px;border:1px solid var(--border); font-size:12px; color:#9cc1ff; background:#0b152b}
    .actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    /* Leaderboard */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}

    /* Bottom Nav */
    nav.bottom{
      position:fixed; bottom:0; left:0; right:0; z-index:40; background:rgba(11,18,34,.85); backdrop-filter:blur(10px); border-top:1px solid var(--border);
    }
    .bottom-inner{display:grid;grid-template-columns:repeat(5,1fr);}
    .navbtn{padding:10px 6px; display:flex; flex-direction:column; align-items:center; gap:6px; color:var(--muted); font-size:12px; cursor:pointer}
    .navbtn.active{color:#cfe1ff}

    /* Profile */
    .profile{display:grid;gap:12px}
    .progress{height:10px;background:#091020;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .progress > div{height:100%;background:linear-gradient(90deg,var(--brand),var(--brand-2));width:0%}

    /* Utilities */
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .right{margin-left:auto}
    .muted{color:var(--muted)}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <a class="skip-link" href="#main" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">Skip to content</a>

  <header class="appbar" role="banner" aria-label="Top Navigation">
    <div class="appbar-inner">
      <div class="logo" aria-label="Youth Digital Advocacy Hub">
        <span class="dot" aria-hidden="true"></span>
        <span>Youth Digital Advocacy Hub</span>
      </div>
      <span class="badge" title="Built for Ghana ‚Äî Mobile first" style="margin-left:8px;">
        <span class="pulse"></span> Ghana ‚Ä¢ Mobile First
      </span>
      <div class="right row">
        <button id="contrastBtn" class="btn sm ghost" aria-pressed="false" title="Toggle High Contrast">High Contrast</button>
        <select id="langSel" aria-label="Language">
          <option value="en">English</option>
          <option value="tw">Twi (placeholder)</option>
        </select>
        <button id="authBtn" class="btn sm icon" aria-controls="authModal">
          <span>Login</span>
        </button>
      </div>
    </div>
  </header>

  <main id="main" class="container" tabindex="-1">
    <!-- Hero / Intro -->
    <section class="hero" aria-label="Intro">
      <article class="card">
        <div class="card-header">
          <h3 data-i18n="intro_title">Raise Issues. Build Solutions. Lead Change.</h3>
          <button id="newIssueBtn" class="btn sm">+ <span data-i18n="new_issue">New Issue</span></button>
        </div>
        <div class="card-body">
          <p class="muted" data-i18n="intro_copy">An open, youth-led space to surface community challenges across Ghana, propose practical fixes, and collaborate with mentors and peers. Earn badges, climb the leaderboard, and amplify your voice to policymakers.</p>
          <div class="row" style="margin-top:10px">
            <div class="chip">#SocialJustice</div>
            <div class="chip">#ClimateAction</div>
            <div class="chip">#GoodGovernance</div>
          </div>
        </div>
      </article>

      <aside class="card" aria-label="Quick Stats">
        <div class="card-header">
          <h3 data-i18n="quick_stats">Quick Stats</h3>
        </div>
        <div class="card-body grid" id="quickStats">
          <!-- Populated by JS -->
        </div>
      </aside>
    </section>

    <!-- Tabs / Filters -->
    <section class="card" style="margin-top:16px" aria-label="Filters">
      <div class="card-body tabs" id="categoryTabs" role="tablist">
        <button class="tab active" role="tab" data-cat="all">All</button>
        <button class="tab" role="tab" data-cat="social">Social Justice</button>
        <button class="tab" role="tab" data-cat="climate">Climate Action</button>
        <button class="tab" role="tab" data-cat="governance">Good Governance</button>
        <button class="tab" role="tab" data-cat="mentors">Mentor Tips</button>
      </div>
    </section>

    <!-- Issues Feed -->
    <section class="grid" id="feed" aria-label="Issues Feed" style="margin-top:16px">
      <!-- Populated by JS -->
    </section>

    <!-- Media Hub -->
    <section class="card" style="margin-top:16px" aria-label="Media Hub">
      <div class="card-header">
        <h3>Media Hub</h3>
        <span class="muted">Short stories ‚Ä¢ Podcasts ‚Ä¢ Campaigns</span>
      </div>
      <div class="card-body grid" style="grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px">
        <div class="card">
          <div class="card-body">
            <strong>Youth Story (Video)</strong>
            <div style="aspect-ratio:16/9; background:#000; border-radius:12px; overflow:hidden; margin-top:8px">
              <iframe title="Youth Story" width="100%" height="100%" src="https://www.youtube.com/embed/dQw4w9WgXcQ" allowfullscreen></iframe>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <strong>Podcast Snippet</strong>
            <audio controls style="width:100%; margin-top:8px">
              <source src="https://www2.cs.uic.edu/~i101/SoundFiles/StarWars60.wav" type="audio/wav">
              Your browser does not support audio.
            </audio>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <strong>Campaign Card</strong>
            <p class="muted">Plastic-free markets challenge ‚Äî Join the pledge and share tactics that work in your community.</p>
            <button class="btn sm">Join Campaign</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Leaderboard & Profile Row -->
    <section class="grid" style="grid-template-columns:1fr 1fr; margin-top:16px">
      <article class="card" aria-label="Leaderboard">
        <div class="card-header"><h3>Leaderboard</h3></div>
        <div class="card-body">
          <table id="leaderboard" aria-describedby="Leaderboard of top contributors">
            <thead><tr><th>#</th><th>User</th><th>XP</th><th>Badges</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </article>

      <article class="card" aria-label="Profile">
        <div class="card-header row">
          <h3>Profile</h3>
          <button id="editProfileBtn" class="btn sm ghost right">Edit</button>
        </div>
        <div class="card-body profile" id="profile">
          <!-- Populated by JS -->
        </div>
      </article>
    </section>
  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom" aria-label="Bottom Navigation">
    <div class="bottom-inner">
      <button class="navbtn active" data-goto="main" aria-label="Home">üè†<span>Home</span></button>
      <button class="navbtn" id="openIssueModal" aria-label="Post">‚ûï<span>Post</span></button>
      <button class="navbtn" id="gotoLeaderboard" aria-label="Leaderboard">üèÜ<span>Rank</span></button>
      <button class="navbtn" id="gotoMedia" aria-label="Media">üéß<span>Media</span></button>
      <button class="navbtn" id="gotoProfile" aria-label="Profile">üë§<span>Me</span></button>
    </div>
  </nav>

  <!-- Auth Modal -->
  <dialog id="authModal" aria-label="Authentication">
    <form method="dialog" class="card" style="min-width:340px">
      <div class="card-header"><h3>Welcome</h3></div>
      <div class="card-body grid">
        <label>Username<input id="authUsername" required/></label>
        <label>Email<input id="authEmail" type="email" required/></label>
        <label>Password<input id="authPassword" type="password" required/></label>
        <div class="row">
          <button id="loginBtn" class="btn">Login / Signup</button>
          <button id="guestBtn" class="btn ghost" value="cancel">Continue as Guest</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- New Issue Modal -->
  <dialog id="issueModal" aria-label="New Issue">
    <form method="dialog" class="card" style="min-width:380px">
      <div class="card-header">
        <h3>Share an Issue</h3>
      </div>
      <div class="card-body grid">
        <label>Title<input id="issueTitle" maxlength="120" required/></label>
        <label>Category
          <select id="issueCategory">
            <option value="social">Social Justice</option>
            <option value="climate">Climate Action</option>
            <option value="governance">Good Governance</option>
          </select>
        </label>
        <label>Description<textarea id="issueDesc" maxlength="800" required></textarea></label>
        <div class="row">
          <button id="postIssueBtn" class="btn">Post</button>
          <button class="btn ghost" value="cancel">Cancel</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- Comment Modal -->
  <dialog id="commentModal" aria-label="Add Comment">
    <form method="dialog" class="card" style="min-width:380px">
      <div class="card-header"><h3>Add Comment</h3></div>
      <div class="card-body grid">
        <label>
          As Mentor?
          <select id="commentMentorFlag">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </label>
        <label>Comment<textarea id="commentText" maxlength="400" required></textarea></label>
        <div class="row">
          <button id="addCommentBtn" class="btn">Add</button>
          <button class="btn ghost" value="cancel">Cancel</button>
        </div>
      </div>
    </form>
  </dialog>

  <script>
  // ===== Utilities =====
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const uid = () => Math.random().toString(36).slice(2,9);
  const now = () => new Date().toISOString();
  const fmt = iso => new Date(iso).toLocaleString();

  const store = {
    get(k, d){ try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d; } },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
  }

  // ===== App State =====
  const STATE = {
    users: store.get('users', {}),            // username -> {username,email,avatar,xp,badges:{},posts,comments}
    issues: store.get('issues', []),          // [{id,title,desc,cat,author,ts,upvotes,solutions:[{id,text,author,mentor,ts}]}]
    currentUser: store.get('currentUser', null),
    lang: store.get('lang','en'),
    highContrast: store.get('hc', false),
  }

  function persist(){
    store.set('users', STATE.users);
    store.set('issues', STATE.issues);
    store.set('currentUser', STATE.currentUser);
    store.set('lang', STATE.lang);
    store.set('hc', STATE.highContrast);
  }

  // ===== i18n (Minimal) =====
  const I18N = {
    en: {
      intro_title: 'Raise Issues. Build Solutions. Lead Change.',
      intro_copy: 'An open, youth-led space to surface community challenges across Ghana, propose practical fixes, and collaborate with mentors and peers. Earn badges, climb the leaderboard, and amplify your voice to policymakers.',
      new_issue: 'New Issue', quick_stats: 'Quick Stats'
    },
    tw: {
      intro_title: 'B…î as…õm. Si mm…îden. Di nkunim.',
      intro_copy: '∆êy…õ baakofo…î-atitiriw bea ma mm…îfra mmoa de w…în kurom ns…õmm…îne to gu h…î, de mm…îdenb…îm mmra, na adwumay…õfo…î ne nnamfonom mm…î akom. K…î so nya ns…õmma nhyehy…õe, y…õ aky…õde…õ, na ma wo nne…õma so ak…î amany…îs…õmfo nky…õn.',
      new_issue: 'To as…õm k…î so', quick_stats: 'Ntotoho Nt…õmant…õm'
    }
  }
  function applyI18n(){
    const dict = I18N[STATE.lang] || I18N.en;
    $$('[data-i18n]').forEach(el=>{ const k=el.getAttribute('data-i18n'); if(dict[k]) el.textContent = dict[k]; });
    $('#langSel').value = STATE.lang;
  }

  // ===== Gamification =====
  const BADGE_DEFS = [
    { id:'first_post', name:'First Voice', cond:u=>u.posts>=1 },
    { id:'five_posts', name:'Community Champion', cond:u=>u.posts>=5 },
    { id:'helper', name:'Peer Helper', cond:u=>u.comments>=5 },
    { id:'mentor_mark', name:'Mentor Ally', cond:u=>u.mentorComments>=3 },
  ];
  function awardBadges(username){
    const u = STATE.users[username]; if(!u) return;
    u.badges = u.badges || {};
    BADGE_DEFS.forEach(b=>{ if(b.cond(u)) u.badges[b.id]=b.name; });
  }
  function calcXP(u){
    return 10*(u.posts||0) + 3*(u.comments||0) + 5*(u.mentorComments||0) + (u.upvotesGiven||0);
  }

  // ===== Auth =====
  function ensureUser(username, email){
    if(!STATE.users[username]){
      STATE.users[username] = { username, email, avatar: initials(username), xp:0, badges:{}, posts:0, comments:0, mentorComments:0, upvotesGiven:0 };
    }
    return STATE.users[username];
  }
  function initials(name){ return name.split(/\s+/).map(s=>s[0]?.toUpperCase()).slice(0,2).join('') || 'YU'; }

  // ===== Seed Demo Data (first run) =====
  if(STATE.issues.length===0){
    const demoUsers = [['Ama Mensah','ama@demo.gh'],['Kofi Mensah','kofi@demo.gh'],['Mentor A','mentor@hub.gh']];
    demoUsers.forEach(([u,e])=>ensureUser(u,e));
    const D = [
      { title:'Flooding around Kaneshie market', cat:'climate', desc:'Heavy rains block drains and flood stalls. Need community clean-up and council engagement.', author:'Ama Mensah' },
      { title:'Voter education for first-time voters', cat:'governance', desc:'Design youth-friendly explainers in Twi and Dagbani with WhatsApp infographics.', author:'Kofi Mensah' },
      { title:'Girls safety on school routes', cat:'social', desc:'Unsafe paths after dusk. Propose safe-route mapping and community watch.', author:'Ama Mensah' }
    ];
    D.forEach(x=> addIssue(x.title,x.desc,x.cat,x.author,true));
    addComment(STATE.issues[0].id, 'Coordinate with NADMO and market leaders; start monthly desilting days.', 'Mentor A', true, true);
    addComment(STATE.issues[1].id, 'Run a mock-ballot event at SHSs with IEC materials.', 'Mentor A', true, true);
  }

  // ===== Rendering =====
  function render(){
    applyI18n();
    renderStats();
    renderFeed();
    renderLeaderboard();
    renderProfile();
    document.body.classList.toggle('high-contrast', !!STATE.highContrast);
  }

  function renderStats(){
    const el = $('#quickStats');
    const totals = {
      issues: STATE.issues.length,
      comments: STATE.issues.reduce((a,i)=>a+(i.solutions?.length||0),0),
      mentors: Object.values(STATE.users).filter(u=>u.mentorComments>0).length,
    };
    el.innerHTML = `
      <div class="row" style="justify-content:space-between">
        <div><strong>${totals.issues}</strong><div class="muted">Issues</div></div>
        <div><strong>${totals.comments}</strong><div class="muted">Comments</div></div>
        <div><strong>${totals.mentors}</strong><div class="muted">Mentors</div></div>
      </div>
    `;
  }

  function issueChip(cat){
    const map = {social:'#SocialJustice', climate:'#ClimateAction', governance:'#GoodGovernance'};
    return `<span class="chip">${map[cat]||'#General'}</span>`
  }

  function renderFeed(){
    const feed = $('#feed');
    const active = $('.tab.active')?.dataset.cat || 'all';
    const list = STATE.issues.slice().reverse().filter(i=> active==='all' ? true : (active==='mentors' ? (i.solutions||[]).some(s=>s.mentor) : i.cat===active));
    feed.innerHTML = list.map(i=>{
      const solutions = (i.solutions||[]).map(s=>`
        <div class="row" style="align-items:flex-start">
          <div class="chip" style="${s.mentor?'color:#baffc1;border-color:#2dd36f;background:#0d2816':''}">${s.mentor?'Mentor':'Peer'}</div>
          <div><strong>${s.author}</strong> <span class="muted">‚Ä¢ ${fmt(s.ts)}</span><br/>${escapeHtml(s.text)}</div>
        </div>
      `).join('');
      const up = i.upvotes||0;
      return `
        <article class="issue" data-id="${i.id}">
          <div class="meta">
            <strong>${escapeHtml(i.title)}</strong>
            <span class="muted">by ${i.author}</span>
            ${issueChip(i.cat)}
            <span class="muted">${fmt(i.ts)}</span>
          </div>
          <div>${escapeHtml(i.desc)}</div>
          <div class="actions">
            <button class="btn sm ghost" data-action="upvote">‚¨ÜÔ∏é Upvote (${up})</button>
            <button class="btn sm ghost" data-action="comment">üí¨ Comment</button>
            <span class="muted">${(i.solutions||[]).length} comments</span>
          </div>
          <div class="grid" style="margin-top:8px">${solutions||'<span class="muted">No comments yet.</span>'}</div>
        </article>
      `;
    }).join('');

    // bind action buttons
    $$('#feed [data-action="upvote"]').forEach(btn=> btn.onclick = onUpvote);
    $$('#feed [data-action="comment"]').forEach(btn=> btn.onclick = openCommentModal);
  }

  function renderLeaderboard(){
    const tbody = $('#leaderboard tbody');
    const rows = Object.values(STATE.users).map(u=>{
      u.xp = calcXP(u); awardBadges(u.username);
      return u;
    }).sort((a,b)=>b.xp-a.xp).slice(0,50);

    tbody.innerHTML = rows.map((u,idx)=>`
      <tr>
        <td>${idx+1}</td>
        <td>${escapeHtml(u.username)}</td>
        <td>${u.xp}</td>
        <td>${Object.keys(u.badges||{}).length}</td>
      </tr>
    `).join('');
  }

  function renderProfile(){
    const wrap = $('#profile');
    const u = STATE.currentUser ? STATE.users[STATE.currentUser] : null;
    if(!u){
      wrap.innerHTML = `<p class="muted">You are not logged in. <button class="btn sm" id="inlineLogin">Login</button></p>`;
      $('#inlineLogin').onclick = ()=> $('#authModal').showModal();
      return;
    }
    const pct = Math.min(100, Math.round((u.xp%100)));
    const badges = Object.values(u.badges||{}).map(n=>`<span class="chip">${n}</span>`).join('') || '<span class="muted">No badges yet.</span>';
    wrap.innerHTML = `
      <div class="row" style="align-items:center">
        <div class="chip" style="font-weight:700;font-size:18px">${initials(u.username)}</div>
        <div>
          <div><strong>${escapeHtml(u.username)}</strong></div>
          <div class="muted">${escapeHtml(u.email)}</div>
        </div>
      </div>
      <div>XP: <strong>${u.xp}</strong></div>
      <div class="progress" aria-label="XP Progress"><div style="width:${pct}%"></div></div>
      <div><strong>Badges</strong><div class="row" style="margin-top:6px">${badges}</div></div>
    `;
  }

  // ===== Actions =====
  function addIssue(title, desc, cat, author, silent=false){
    const item = { id:uid(), title, desc, cat, author, ts:now(), upvotes:0, solutions:[] };
    STATE.issues.push(item);
    const u = ensureUser(author, author+"@local");
    u.posts=(u.posts||0)+1; u.xp = calcXP(u); awardBadges(author);
    persist(); if(!silent) render(); return item;
  }

  function addComment(issueId, text, author, mentor=false, silent=false){
    const it = STATE.issues.find(i=>i.id===issueId); if(!it) return;
    it.solutions = it.solutions||[];
    it.solutions.push({ id:uid(), text, author, mentor, ts:now() });
    const u = ensureUser(author, author+"@local");
    if(mentor) u.mentorComments=(u.mentorComments||0)+1; else u.comments=(u.comments||0)+1;
    u.xp = calcXP(u); awardBadges(author);
    persist(); if(!silent) render();
  }

  function onUpvote(e){
    const art = e.target.closest('.issue'); const id = art?.dataset.id; if(!id) return;
    const it = STATE.issues.find(i=>i.id===id); if(!it) return;
    it.upvotes=(it.upvotes||0)+1;
    if(STATE.currentUser){ STATE.users[STATE.currentUser].upvotesGiven=(STATE.users[STATE.currentUser].upvotesGiven||0)+1; }
    persist(); render();
  }

  // ===== Modals & Event Bindings =====
  const authModal = $('#authModal');
  const issueModal = $('#issueModal');
  const commentModal = $('#commentModal');
  let commentForIssue = null;

  $('#authBtn').onclick = ()=> authModal.showModal();
  $('#newIssueBtn').onclick = ()=> issueModal.showModal();
  $('#openIssueModal').onclick = ()=> issueModal.showModal();

  $('#loginBtn').onclick = (e)=>{
    e.preventDefault();
    const u = $('#authUsername').value.trim();
    const em = $('#authEmail').value.trim();
    if(!u || !em) return;
    ensureUser(u, em); STATE.currentUser = u; persist(); authModal.close(); render();
    $('#authBtn').innerHTML = 'Logout';
    $('#authBtn').onclick = ()=>{ STATE.currentUser=null; persist(); render(); location.hash=''; };
  }
  $('#guestBtn').onclick = ()=>{ authModal.close(); }

  $('#postIssueBtn').onclick = (e)=>{
    e.preventDefault();
    const t=$('#issueTitle').value.trim(); const d=$('#issueDesc').value.trim(); const c=$('#issueCategory').value; if(!t||!d) return;
    const author = STATE.currentUser || 'Guest User';
    addIssue(t,d,c,author); issueModal.close(); $('#issueTitle').value=''; $('#issueDesc').value='';
  }

  function openCommentModal(e){
    const art = e.target.closest('.issue'); commentForIssue = art?.dataset.id; if(!commentForIssue) return;
    commentModal.showModal();
  }
  $('#addCommentBtn').onclick = (e)=>{
    e.preventDefault();
    const txt = $('#commentText').value.trim(); if(!txt) return;
    const mentor = $('#commentMentorFlag').value==='yes';
    const author = STATE.currentUser || (mentor? 'Mentor (Guest)':'Guest User');
    addComment(commentForIssue, txt, author, mentor); commentModal.close(); $('#commentText').value='';
  }

  // Tabs
  $$('#categoryTabs .tab').forEach(tab=> tab.onclick = ()=>{ $$('#categoryTabs .tab').forEach(t=>t.classList.remove('active')); tab.classList.add('active'); renderFeed(); });

  // Bottom nav helpers
  $('#gotoLeaderboard').onclick = ()=> document.querySelector('[aria-label="Leaderboard"]').scrollIntoView({behavior:'smooth'});
  $('#gotoMedia').onclick = ()=> document.querySelector('[aria-label="Media Hub"]').scrollIntoView({behavior:'smooth'});
  $('#gotoProfile').onclick = ()=> document.querySelector('[aria-label="Profile"]').scrollIntoView({behavior:'smooth'});

  // Contrast + Lang
  $('#contrastBtn').onclick = ()=>{ STATE.highContrast=!STATE.highContrast; persist(); render(); };
  $('#langSel').onchange = (e)=>{ STATE.lang=e.target.value; persist(); render(); };

  // Accessibility helpers
  function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

  // Init
  render();
  </script>
</body>
</html>
